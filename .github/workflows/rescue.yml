name: Manual Rescue - Restore Deploy Script

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  rescue:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Force Restore Deploy Script to Main
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          # 1. 切換到 main
          git checkout main
          
          # 2. 確保資料夾存在並恢復 deploy.yml
          mkdir -p .github/workflows
          git checkout automation -- .github/workflows/deploy.yml
          
          # 3. 自動修改 vite.config.ts (核心重點)
          # 使用 sed 在 plugins: [ 這一行前面插入 base 設定
          # 如果原本已經有 base 會先刪除再重新插入，確保不重複
          sed -i "/base:/d" vite.config.ts
          sed -i "/plugins: \[/i \  base: '/Senlogic/'," vite.config.ts
          
          # 4. 推回 main
          git add .github/workflows/deploy.yml vite.config.ts
          git commit -m "Rescue: Restore deploy.yml and auto-add base path" || echo "No changes"
          git push origin main
